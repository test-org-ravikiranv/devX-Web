version: v1.0
name: Node.js CI
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Docker Build & Push
    task:
      jobs:
        - name: Docker Build & Push
          commands:
            - checkout
            - 'docker build -t ravikirankiran097/devx-semophore:v1.0 .'
            - echo $DOCKERHUB_PASSWORD | docker login --username "$DOCKERHUB_USERNAME" --password-stdin
            - 'docker push ravikirankiran097/devx-semophore:v1.0'
            - docker logout
      secrets:
        - name: dockerhub_secret
    dependencies: []
  - name: Build & Create Artifacts
    task:
      jobs:
        - name: Build & Push to Artifact
          commands:
            - checkout
            - sem-version node 18
            - npm install
            - npm run build --if-present
            - ls
            - artifacts push workflow build
      env_vars:
        - name: CI
          value: 'false'
    dependencies:
      - Docker Build & Push
