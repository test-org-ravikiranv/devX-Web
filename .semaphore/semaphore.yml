version: v1.0
name: Test MyApp
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Test
    task:
      jobs:
        - name: devX
          commands:
            - checkout
            - sem-version node 18
            - cache restore
            - npm install
            - cache store
            - npm run build --if-present
      env_vars:
        - name: CI
          value: 'false'
      epilogue:
        always:
          commands:
            - echo "Build complete"
  - name: Docker Build & Push
    task:
      jobs:
        - name: Docker Build
          commands:
            - checkout
            - 'docker build -t ravikirankiran097/devx-semophore:v1.0 .'
        - name: Docker Push
          commands:
            - 'docker push ravikirankiran097/devx-semophore:v1.0'
